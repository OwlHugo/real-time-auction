<div class="container mx-auto px-4 py-8" *ngIf="auction">
  <div *ngIf="showOutbidAlert"
    class="fixed top-24 left-1/2 -translate-x-1/2 z-[100] bg-red-600 text-white px-8 py-4 rounded-2xl shadow-2xl flex items-center space-x-3 animate-bounce">
    <i class="bi bi-exclamation-triangle-fill text-2xl"></i>
    <div>
      <p class="font-black leading-none">LANCE SUPERADO</p>
      <p class="text-xs opacity-80">Um novo lance foi registrado. Você pode aumentar sua oferta para retomar a
        liderança.</p>
    </div>
  </div>

  <a [routerLink]="['/auctions']"
    class="inline-flex items-center text-slate-400 hover:text-white mb-6 transition group cursor-pointer">
    <i class="bi bi-arrow-left mr-2 group-hover:-translate-x-1 transition"></i> Voltar para Lista
  </a>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
    <div class="glass p-8 rounded-3xl relative overflow-hidden flex flex-col justify-between">
      <div
        class="absolute top-0 right-0 bg-gradient-to-l from-indigo-600 to-transparent text-white pl-8 pr-4 py-2 rounded-bl-2xl font-bold uppercase tracking-wider text-sm">
        {{ auction.status === 2 ? 'Ativo' : (auction.status === 3 ? 'Encerrado' : 'Agendado') }}
      </div>

      <div>
        <h1 class="text-4xl md:text-5xl font-black text-slate-800 dark:text-white mb-6 leading-tight">{{ auction.title
          }}</h1>
        <p class="text-lg text-slate-600 dark:text-slate-300 leading-relaxed mb-8">{{ auction.description }}</p>
      </div>

      <div class="grid grid-cols-2 gap-4 mt-auto">
        <div class="p-5 rounded-2xl bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700/50">
          <p class="text-xs text-slate-500 uppercase tracking-widest mb-1">Vendedor</p>
          <p class="font-bold text-slate-800 dark:text-slate-200 truncate">{{ auction.seller || 'Anônimo' }}</p>
        </div>
        <div class="p-5 rounded-2xl bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700/50">
          <p class="text-xs text-slate-500 uppercase tracking-widest mb-1">Tempo Restante</p>
          <p class="font-bold text-2xl"
            [ngClass]="isLowTime ? 'text-red-500 animate-pulse' : 'text-slate-800 dark:text-slate-200'">
            {{ timeLeft }}
          </p>
        </div>
      </div>
    </div>

    <div
      class="glass p-8 rounded-3xl border-2 border-indigo-500/30 flex flex-col justify-center relative shadow-2xl shadow-indigo-900/20">
      <div class="absolute inset-0 bg-indigo-500/5 rounded-3xl animate-pulse-slow pointer-events-none"></div>

      <div class="relative z-10 text-center">
        <p class="text-sm text-slate-500 uppercase tracking-[0.2em] mb-4 font-semibold">Lance Atual</p>
        <h2
          class="text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-500 mb-8 drop-shadow-sm">
          {{ auction.currentPrice | currency }}
        </h2>

        <div class="w-24 h-1 bg-gradient-to-r from-transparent via-slate-700 to-transparent mx-auto mb-8 rounded-full">
        </div>

        <div *ngIf="isLoggedIn; else loginToBid">
          <div class="flex items-center space-x-4 mb-6">
            <div class="flex-grow">
              <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2 ml-1">Sua
                Oferta</label>
              <div class="relative">
                <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold">$</span>
                <input type="number" [(ngModel)]="bidAmount" [min]="auction.currentPrice + 1"
                  class="w-full bg-slate-900 border border-slate-700 rounded-2xl pl-8 pr-4 py-4 text-white focus:border-indigo-500 outline-none transition font-mono text-xl">
              </div>
            </div>
          </div>

          <div *ngIf="bidError"
            class="p-4 bg-red-500/10 border border-red-500/20 rounded-2xl text-red-500 text-xs text-center mb-4 animate-pulse">
            {{ bidError }}
          </div>

          <button (click)="placeBid()"
            [disabled]="bidAmount <= auction.currentPrice || auction.status !== 2 || isSubmittingBid"
            class="w-full py-5 rounded-2xl bg-gradient-to-r from-indigo-600 to-pink-600 hover:from-indigo-500 hover:to-pink-500 text-white font-black text-xl tracking-wide shadow-xl shadow-indigo-500/30 transition-all transform hover:-translate-y-1 active:scale-95 disabled:opacity-50 disabled:grayscale disabled:cursor-not-allowed flex items-center justify-center">
            <span *ngIf="!isSubmittingBid">{{ auction.status === 2 ? 'ENVIAR LANCE' : (auction.status === 3 ? 'LEILÃO
              ENCERRADO' : 'AGUARDANDO INÍCIO') }}</span>
            <span *ngIf="isSubmittingBid" class="flex items-center">
              <svg class="animate-spin -ml-1 mr-3 h-6 w-6 text-white" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                </path>
              </svg>
              PROCESSANDO...
            </span>
          </button>

          <p class="text-xs text-slate-500 mt-4">
            Ao confirmar, você concorda com os Termos de Serviço do Arrematch.
          </p>
        </div>

        <ng-template #loginToBid>
          <div class="p-8 rounded-2xl bg-indigo-500/5 border border-indigo-500/10 text-center">
            <p class="text-slate-400 mb-6 px-4">Faça login na sua conta para poder participar e enviar lances neste
              leilão.</p>
            <a [routerLink]="['/login']"
              class="inline-block px-8 py-4 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-2xl transition-all shadow-lg shadow-indigo-500/20">
              ACESSAR MINHA CONTA
            </a>
          </div>
        </ng-template>
      </div>

      <div class="lg:col-span-2 mt-4" *ngIf="auction.recentBids && auction.recentBids.length > 0">
        <div class="glass p-8 rounded-3xl">
          <h3 class="text-xl font-bold text-slate-800 dark:text-white mb-6 flex items-center">
            <i class="bi bi-clock-history mr-3 text-indigo-500"></i> Últimos Lances
          </h3>

          <div class="overflow-hidden rounded-2xl border border-slate-200 dark:border-slate-700/50">
            <table class="w-full text-left">
              <thead class="bg-slate-100 dark:bg-slate-800/80">
                <tr>
                  <th class="p-4 text-xs font-extrabold text-slate-500 uppercase tracking-widest">Valor</th>
                  <th class="p-4 text-xs font-extrabold text-slate-500 uppercase tracking-widest">Data</th>
                  <th class="p-4 text-xs font-extrabold text-slate-500 uppercase tracking-widest text-right">Licitante
                    (ID)
                  </th>
                </tr>
              </thead>
              <tbody class="divide-y divide-slate-200 dark:divide-slate-700/50 bg-slate-50/50 dark:bg-slate-900/20">
                <tr *ngFor="let bid of auction.recentBids" class="hover:bg-indigo-500/5 transition">
                  <td class="p-4 "
                    [ngClass]="bid.bidderId === currentUserId ? 'text-green-500 font-black' : 'text-indigo-600 dark:text-indigo-400 font-bold'">
                    {{ bid.amount | currency }}
                    <span *ngIf="bid.bidderId === currentUserId"
                      class="ml-2 text-[10px] bg-green-500/20 px-2 py-0.5 rounded-full uppercase">Seu Lance</span>
                  </td>
                  <td class="p-4 text-slate-600 dark:text-slate-300">{{ bid.placeAt | date:'medium' }}</td>
                  <td class="p-4 text-slate-500 dark:text-slate-400 text-right font-mono text-xs">{{ bid.bidderId ||
                    'Anônimo' }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="!auction"
      class="flex justify-center items-center h-screen w-full absolute top-0 left-0 bg-slate-950 z-50">
      <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-indigo-500"></div>
    </div>
